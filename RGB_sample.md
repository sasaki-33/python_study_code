

# RGB値から距離変化を算出する
## ※As this program is experiment,I don't guarantee accuracy
## 序論
光は大気中のゴミやチリの分子とぶつかり減衰していく。    
光には「光の散乱」という性質があるからである。  
減衰は「光の散乱」により発生し、特に光の波長より小さな粒子による散乱では、光の波長が短いほど散乱される割合が大きい。  
色は光の波長により決まり、可視域では波長が短い光は青色、波長が長い光は赤色に近くなる。  
つまり、波長の短い青色の光は減衰しやすくなる。  
夕焼けもこの原理に基づき発生している。  

>[出典:アンディマンのテクノロジー(援技力)]   http://andyman.techblog.jp/archives/21102117.html 


*環境を全く同じ状況とし、光源との距離のみが変化すると仮定したとき、光の減衰によりRGB値は変化するはずである。*  
*RGB値の変化と距離変化の関係パラメータを実験的に求め、RGB値から距離変化を算出してみることを目的とする。*  
***
## 方法
観測する地点から光源のデジタル写真を取り、画像からRGB値を入手する。  
光源を移動(距離を離す)させ、再度RGB値を入手する。  

### 準備1.逆二乗の法則  
光源の変化として、逆二乗の法則を用いる。  
逆二乗の法則とは、物理量の大きさがその発生源からの距離の二乗に反比例する、という法則である。  
例えば、光源の強さがCd(cd)、観測地との距離をr(m)、観測地での測定した明るさをE(lx)とした時、  
*E = Cd/r^2*となる。  
これらを用いて同じ環境条件の下、外乱の影響を無視した時の光源画像のRGB値について  
* R値 = E × exp[x]  = (Cd/r^2) × exp[x] 
* G値 = E × exp[y]  = (Cd/r^2) × exp[y] 
* B値 = E × exp[z]  = (Cd/r^2) × exp[z]     
exp[]はe^を表し、eはネイピア数である。    
x,y,z = -(観測の波長-中心波長/正規分布の半値半幅)^2 

### 準備2.波長の求め方
上記の中心波長はCIE(国際照明委員会)で、R=700.0nm,G=546.1nm,B=435.8nmと定められている。  
半値半幅はそれぞれ、(90,80,80)である。  
また、観測の波長はxyz色空間値と波長の変換により求める。   
[参照ソースコード](https://github.com/sobotka/blender/blob/3076d95ba441cd32706a27d18922a30f8fd28b8a/intern/cycles/kernel/svm/svm_wavelength.h) 

RGB値からxyz色空間値への変換は、ITU-T BT.709で定義されている変換式を用いて行い、xyz色空間値から波長を求める。  


>[出典:RGBからXYZへの変換]http://vig.is.env.kitakyu-u.ac.jp/etc/rgb2xyz.html  


